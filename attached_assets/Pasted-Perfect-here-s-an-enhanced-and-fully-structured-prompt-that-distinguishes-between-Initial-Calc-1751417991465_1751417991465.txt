Perfect â€” hereâ€™s an enhanced and fully structured prompt that distinguishes between:
	â€¢	Initial Calculation: Build historical Units Per Hour (UPH) data from all completed Work Orders (WOs) in the database.
	â€¢	Ongoing Weekly Estimation: Estimate hours required for current open MOs using the UPH database.

You can paste this directly into your Replit Agent or prompt execution layer.

â¸»

ğŸ”§ Replit Agent Prompt â€” Units Per Hour (UPH) Engine

â¸»

ğŸ¯ Objective

Build a two-part Units Per Hour (UPH) calculation engine for Atlas Pet Company production planning.

â¸»

ğŸ“ Part 1: Historical UPH Calculation (One-Time / Nightly Task)

Goal: Build a reliable, operator-level Units Per Hour table by processing all completed WOs from Fulfilâ€™s database.

ğŸ“¥ Input:
	â€¢	work_orders table: includes id, work_center, operation, operator, routing, mo_id, quantity
	â€¢	work_cycles table: includes cycle_id, wo_id, operator, duration (seconds), quantity_done
	â€¢	Work Center can include extended names like "Cutting - LH", "Packaging - Test" â€” normalize these to one of:

Cutting, Rope, Assembly, Packaging



ğŸ§  Logic:
	1.	For each Work Order:
	â€¢	Group all cycles by work_center + operator + routing
	â€¢	Normalize Work Center name using substring match
	â€¢	Sum:
	â€¢	Total quantity = sum of quantity_done
	â€¢	Total time (hours) = sum of duration Ã· 3600
	2.	Calculate:

UPH = Total Quantity / Total Hours


	3.	Store in new table:

operator_uph (
  operator TEXT,
  routing TEXT,
  work_center TEXT,
  units_per_hour FLOAT,
  observations INT
)



â¸»

ğŸ“ Part 2: Weekly MO Estimator (Live / Interactive Calculation)

Goal: For all MOs not in Done state (draft, waiting, assigned, running), estimate total hours required per Work Center, based on operator UPH.

ğŸ“¥ Input:
	â€¢	manufacturing_orders table: includes mo_id, routing, state
	â€¢	work_orders: use associated mo_id, quantity, work_center, operation
	â€¢	operator_uph: built from Part 1

ğŸ§  Logic:
	1.	For each MO:
	â€¢	Group WOs by Work Center
	â€¢	Present dropdown to assign an operator to each Work Center
	â€¢	If operator is selected:
	â€¢	Lookup UPH in operator_uph
	â€¢	If no data exists for operator+work center+routing, fallback to average UPH for that work center/routing
	2.	Estimate time per Work Center:

Estimated Hours = Work Order Quantity Ã· Units Per Hour


	3.	Sum all values to produce:
	â€¢	Time per Work Center per MO
	â€¢	Total time per MO
	â€¢	Total time across all open MOs

ğŸ§¾ Output:
	â€¢	Table with:
	â€¢	Rows = MOs
	â€¢	Columns = [Cutting, Rope, Assembly, Packaging, Total]
	â€¢	Cell = Estimated time in hours
	â€¢	Dropdowns to assign operators per Work Center
	â€¢	Total footer row = sum across all MOs

â¸»

ğŸ” Refresh Triggers
	â€¢	Part 1 can run nightly or when new MOs are marked Done
	â€¢	Part 2 should run whenever:
	â€¢	New MOs are created or change state
	â€¢	User changes operator assignments

â¸»

âœ… Deliverables
	â€¢	One calculate_uph() function for Part 1
	â€¢	One estimate_mo_hours(active_mos, operator_assignments) function for Part 2
	â€¢	Returns structured JSON or SQL results that can be used in UI or dashboards
